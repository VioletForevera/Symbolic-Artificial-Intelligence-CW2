# WSP求解器：终极解决方案总结

## 🎯 问题诊断

4-constraint-hard实例的特点：
- **500用户，60步骤**
- **716个约束**（500个授权 + 184个SoD + 32个At-most-k）
- **高约束密度**: SoD比率 = 184/60 ≈ 3.07
- **解使用高ID用户**: u421, u372, u376等

## ❌ 失败的尝试

### 1. CP-SAT + 布尔变量
- **问题**: 30,000个变量，搜索空间太大
- **结果**: 超时

### 2. CP-SAT + 整数域变量 + 激进剪枝
- **问题**: 剪枝太激进，剪掉了解需要的用户
- **结果**: UNSAT（错误）

### 3. CP-SAT + 整数域变量 + 无剪枝
- **问题**: 500个用户的域太大，约束传播效率低
- **结果**: 超时（180秒）

## ✅ 新方案：专业SAT求解器

### 方案A: Glucose4/MiniSat
**已实现**: `solver_sat.py`

**优势**:
- 专门为SAT问题优化
- 使用CDCL算法（冲突驱动子句学习）
- 比CP-SAT在纯布尔问题上更快

**编码方式**:
```
变量: x[s,u] = 步骤s分配给用户u
约束: CNF子句
```

**状态**: 正在测试中...

### 方案B: 局部搜索（如果SAT也失败）

使用启发式算法：
1. 随机生成初始分配
2. 贪心修复违反的约束
3. 局部搜索优化

## 📊 策略选择矩阵

| 用户数 | 约束密度 | 推荐算法 | 预期时间 |
|-------|---------|----------|----------|
| <100 | 任意 | CP-SAT | <1s |
| 100-300 | 低 | CP-SAT | <30s |
| 100-300 | 高 | SAT | <60s |
| >400 | 任意 | SAT优先 | <120s |

## 🔧 下一步行动

1. **等待SAT求解器测试结果**
2. **如果SAT成功**: 集成到wsp_app.py
3. **如果SAT失败**: 实现启发式搜索
4. **最终方案**: 智能选择器（根据实例特征自动选择算法）

## 💡 关键洞察

WSP问题的难度取决于：
- **约束图的连通性**: SoD约束形成的图结构
- **可行解的密度**: 解空间占搜索空间的比例
- **用户ID分布**: 解可能使用任意ID的用户

对于4-constraint-hard：
- 约束图高度连通（184个SoD）
- 可行解稀疏（大多数分配违反某个约束）
- 需要特定的高ID用户（无法剪枝）

这类问题需要**专业的SAT/CSP求解器**，不适合通用的CP求解器。
